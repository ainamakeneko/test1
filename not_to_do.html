<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>„ÇÑ„Çâ„Å™„Åè„Å¶„ÅÑ„ÅÑ„Åì„Å®„É°„É¢Â∏≥Ôºà„ÅäË©¶„ÅóÁâàÔºâ</title>
<style>
body{font-family:'Noto Sans', sans-serif; margin:0; padding:0; text-align:center; background:#f2f2f2;}
#control{margin:10px;}
#board{position:relative; height:60vh; width:60%; border:1px solid #ccc; margin:10px; overflow:hidden; background:#fff; display:inline-block;}
#stack{position:relative; height:60vh; width:35%; border:1px solid #ccc; margin-top:10px; background:#e8e8e8; display:inline-flex; flex-wrap:wrap; align-content:flex-end; justify-content:flex-start;}
.block{width:20px; height:20px; margin:1px; background:#888;}
.item{position:absolute; cursor:pointer; padding:4px 8px; border-radius:4px; transition:left 1s linear, top 1s linear;}
.explode{position:absolute; pointer-events:none; animation:boom 0.5s forwards; font-size:24px;}
.history{max-height:30vh; overflow-y:auto; background:#fafafa; border-top:1px solid #ccc; padding:5px; text-align:left; font-size:14px;}
.history-entry{margin:2px 0;}
#score{font-size:20px; margin-top:5px;}
#level{font-size:18px; margin-top:5px;}
#celebrate{position:fixed; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.8); font-size:32px; font-weight:bold; z-index:100;}
#ending{position:fixed; top:0; left:0; right:0; bottom:0; background:#000; color:#fff; overflow:auto; display:none; z-index:200;}
#ending div{padding:40px; animation:roll 10s linear forwards; white-space:pre-wrap;}
@keyframes roll{from{transform:translateY(100%);}to{transform:translateY(-100%);}}
#commentBox{display:flex; align-items:center; justify-content:center; margin:10px; font-size:18px;}
#catText{margin-left:10px;}
#comboText{margin-left:10px; color:orange; font-weight:bold;}
@keyframes boom{0%{opacity:1; transform:scale(0);}100%{opacity:0; transform:scale(2);}}
</style>
</head>
<body>
<div id="control">
<select id="profile"></select>
<button id="refresh">ÂÜçË°®Á§∫</button>
</div>
<div id="board"></div>
<div id="stack"></div>
<div id="score">Score: <span id="scoreValue">0</span></div>
<div id="level">Level: <span id="levelValue">1</span></div>
<div id="commentBox">
  <svg id="catImg" width="60" height="60" viewBox="0 0 100 100">
    <circle cx="50" cy="60" r="30" fill="#fdd835" stroke="#555" stroke-width="3"/>
    <polygon points="30,40 20,10 40,30" fill="#fdd835" stroke="#555" stroke-width="3"/>
    <polygon points="70,40 60,10 80,30" fill="#fdd835" stroke="#555" stroke-width="3"/>
    <circle cx="40" cy="55" r="5" fill="#555"/>
    <circle cx="60" cy="55" r="5" fill="#555"/>
    <polygon points="45,65 50,70 55,65" fill="#555"/>
  </svg>
  <span id="catText"></span>
  <span id="comboText"></span>
</div>
<div class="history" id="history"></div>
<div id="celebrate" style="display:none;">„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ</div>
<div id="ending"><div>„ÅîÂà©Áî®„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü\nÂà∂‰ΩúËÄÖ: ÊÄ†„ÅëÁå´AI</div></div>

<script>
const data = {
  '‰ºöÁ§æÂì°ÔºàÁúüÈù¢ÁõÆÔºâ': [
    {text:'„É°„Éº„É´„ÇíËøî„Åô', importance:3, category:'‰ªï‰∫ã'},
    {text:'Ë≥áÊñô„ÇíÈöÖ„ÄÖ„Åæ„ÅßË™≠„ÇÄ', importance:2, category:'‰ªï‰∫ã'},
    {text:'Èù¥„ÇíÊèÉ„Åà„Çã', importance:1, category:'„Éû„Éä„Éº'},
    {text:'ÊÑèÂë≥„ÇÇ„Å™„ÅèÊ∞ó„ÇíÈÅ£„ÅÜ', importance:1, category:'‰∫∫ÈñìÈñ¢‰øÇ'},
    {text:'ÂÆöÊôÇÂæå„ÇÇÊÆã„Çã', importance:2, category:'‰ªï‰∫ã'},
    {text:'ÂÆåÁíß„Å´Êï¥ÁêÜÊï¥È†ì„Åô„Çã', importance:2, category:'Êï¥ÁêÜ'},
    {text:'‰∏äÂè∏„ÅÆÈ°îËâ≤„Çí„ÅÜ„Åã„Åå„ÅÜ', importance:3, category:'‰∫∫ÈñìÈñ¢‰øÇ'},
    {text:'ÁÑ°ÈßÑ„Å™‰ºöË≠∞„ÇíÈñã„Åè', importance:3, category:'‰ªï‰∫ã'},
    {text:'Á§æÂÜÖ„ÉÅ„É£„ÉÉ„Éà„ÇíÂ∏∏ÊôÇÁõ£Ë¶ñ', importance:2, category:'‰ªï‰∫ã'},
    {text:'Â§ú‰∏≠„Å´Ëøî‰ø°„Åô„Çã', importance:1, category:'‰ªï‰∫ã'}
  ],
  '„Éï„É™„Éº„É©„É≥„ÇπÔºàÊ∞ó„Åæ„ÅæÔºâ': [
    {text:'SNS„ÇíÂª∂„ÄÖ„ÉÅ„Çß„ÉÉ„ÇØ', importance:2, category:'ÊôÇÈñìÊµ™Ë≤ª'},
    {text:'ÂÖ®Ê°à‰ª∂Âèó„Åë„Çã', importance:3, category:'‰ªï‰∫ã'},
    {text:'ÂÆåÁíß„Å™„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíÁ´ã„Å¶„Çã', importance:1, category:'Ë®àÁîª'},
    {text:'Ë´ãÊ±ÇÊõ∏„Çí„Éá„Ç≥„Çã', importance:1, category:'„Åù„ÅÆ‰ªñ'},
    {text:'Â§ú„Åµ„Åã„Åó‰ΩúÊ•≠', importance:2, category:'ÂÅ•Â∫∑'},
    {text:'„É°„Éº„É´„ÇíÁßí„ÅßËøî„Åô', importance:2, category:'‰ªï‰∫ã'},
    {text:'ÊØéÊó•Êñ∞„Çµ„Éº„Éì„Çπ„ÇíË©¶„Åô', importance:1, category:'Â≠¶Áøí'},
    {text:'„Çø„Çπ„ÇØ„ÇíËâ≤ÂàÜ„Åë„Åó„Åô„Åé„Çã', importance:1, category:'Êï¥ÁêÜ'},
    {text:'Âç≥„É¨„ÇπÂº∑Ëø´Ë¶≥Âøµ', importance:3, category:'‰ªï‰∫ã'},
    {text:'Ëá™Â∑±ÂïìÁô∫Êú¨„ÇíÁ©ç„ÇÄ', importance:1, category:'Â≠¶Áøí'}
  ],
  '‰∏ªÂ©¶Ôºà„Åå„Çì„Å∞„ÇäÂ±ãÔºâ': [
    {text:'ÊØéÊó•ÂÆåÁíß„Å´ÊéÉÈô§', importance:3, category:'ÂÆ∂‰∫ã'},
    {text:'Ê†ÑÈ§äÂÆåÁíß„Å™„Åî„ÅØ„Çì‰Ωú„Çä', importance:2, category:'ÂÆ∂‰∫ã'},
    {text:'ÂÆ∂Ë®àÁ∞ø„ÇíÁ¥∞„Åã„Åè„Å§„Åë„Çã', importance:2, category:'ÂÆ∂Ë®à'},
    {text:'ËøëÊâÄ‰ªò„ÅçÂêà„ÅÑÂÖ®ÈÉ®ÂèÇÂä†', importance:3, category:'‰∫∫ÈñìÈñ¢‰øÇ'},
    {text:'Â≠ê„Å©„ÇÇ„Å´ÈÅéÂâ∞„Å´Ê∞ó„ÇíÈÖç„Çã', importance:2, category:'ÂÆ∂Êóè'},
    {text:'SNS„ÅßÁêÜÊÉ≥ËÇ≤ÂÖêÊ§úÁ¥¢', importance:1, category:'ÊôÇÈñìÊµ™Ë≤ª'},
    {text:'ÂÆåÁíß„Å™ÂèéÁ¥çË°ì„Å´„Åì„Å†„Çè„Çã', importance:1, category:'Êï¥ÁêÜ'},
    {text:'ÂØù„ÇãÂâç„Å´ÊòéÊó•„ÅÆÊ∫ñÂÇô„ÇíÂÖ®ÈÉ®', importance:2, category:'ÂÆ∂‰∫ã'},
    {text:'Ë∂£Âë≥„ÅÆÊôÇÈñì„ÇíÂæåÂõû„Åó', importance:3, category:'Ëá™ÂàÜ'},
    {text:'ÁåÆÁ´ã„ÇíÔºëÈÄ±ÈñìÂàÜËÄÉ„Åà„Çã', importance:1, category:'ÂÆ∂‰∫ã'}
  ],
  'Â≠¶ÁîüÔºàSNS‰æùÂ≠òÔºâ': [
    {text:'ÂèãÈÅî„ÅÆÊäïÁ®ø„ÇíÂÖ®ÈÉ®Ë¶ã„Çã', importance:2, category:'SNS'},
    {text:'Ë™≤È°å„Çí„ÇÆ„É™„ÇÆ„É™„Åæ„ÅßÊîæÁΩÆ', importance:3, category:'ÂãâÂº∑'},
    {text:'„Ç≤„Éº„É†ÂÆüÊ≥Å„ÇíÂæπÂ§ú„ÅßË¶ñËÅ¥', importance:2, category:'Â®ØÊ•Ω'},
    {text:'ÊïôÁßëÊõ∏„ÇíÈöÖ„Åã„ÇâÈöÖ„Åæ„ÅßÂÜô„Åô', importance:1, category:'ÂãâÂº∑'},
    {text:'Ëøî‰ø°„ÅåÊù•„Çã„Åæ„Åß„Çπ„Éû„ÉõÂáùË¶ñ', importance:2, category:'SNS'},
    {text:'„Å©„ÅÜ„Åß„ÇÇ„ÅÑ„ÅÑ„Ç∞„É´„ÉÅ„É£ÂèÇÂä†', importance:1, category:'SNS'},
    {text:'Âçò‰ΩçË®àÁÆó„ÇíÊØéÊó•Á¢∫Ë™ç', importance:1, category:'ÂãâÂº∑'},
    {text:'ÂÖàÁîü„ÅÆÈ°îËâ≤„Çí„ÅÜ„Åã„Åå„ÅÜ', importance:3, category:'‰∫∫ÈñìÈñ¢‰øÇ'},
    {text:'Êúù„Åæ„Åß„ÉÅ„É£„ÉÉ„Éà', importance:2, category:'SNS'},
    {text:'Ë∂£Âë≥„ÅÆÂãïÁîª„ÇíÁÑ°ÈôêÂÜçÁîü', importance:2, category:'Â®ØÊ•Ω'}
  ],
  'Áå´ÔºàÂÆåÂÖ®Ëá™Áî±Ôºâ': [
    {text:'ÊØõ„Å•„Åè„Çç„ÅÑ„ÇíÂÆåÁíß„Å´„Åô„Çã', importance:2, category:'ÁîüÊ¥ª'},
    {text:'‰∫∫Èñì„Å´Â™ö„Å≥„Çã', importance:3, category:'Ë°åÂãï'},
    {text:'È´ò„ÅÑ„Å®„Åì„Çç„Åã„Çâ‰∏ñÁïåÂæÅÊúç„ÇíÂ¶ÑÊÉ≥', importance:1, category:'Â¶ÑÊÉ≥'},
    {text:'ÊØéÂõû„Åä„ÇÑ„Å§„ÇíË¶ÅÊ±Ç', importance:2, category:'È£ü‰∫ã'},
    {text:'È£º„ÅÑ‰∏ª„ÅÆÂæå„Çí„Åö„Å£„Å®„Å§„ÅÑ„Å¶Âõû„Çã', importance:1, category:'Ë°åÂãï'},
    {text:'„Éç„Ç∫„Éü„ÅÆ„Åä„ÇÇ„Å°„ÇÉ„ÇíÂ∏∏„Å´Áã©„Çã', importance:1, category:'ÈÅä„Å≥'},
    {text:'ÊòºÂØù„ÇíÊàëÊÖ¢', importance:3, category:'ÂÅ•Â∫∑'},
    {text:'Êúù5ÊôÇ„Å´Ëµ∑„Åì„Åô', importance:2, category:'Ë°åÂãï'},
    {text:'ÂÆ∂„Åò„ÇÖ„ÅÜËµ∞„ÇäÂõû„Çã', importance:2, category:'ÈÅä„Å≥'},
    {text:'„ÉÄ„É≥„Éú„Éº„É´ÁÆ±„ÇíÂÖ®ÈÉ®Ë©¶„Åô', importance:1, category:'ÈÅä„Å≥'}
  ]
};

const profileSelect = document.getElementById('profile');
for(const key in data){
  const opt = document.createElement('option');
  opt.value = key;
  opt.textContent = key;
  profileSelect.appendChild(opt);
}
profileSelect.selectedIndex = 0;

const board = document.getElementById('board');
const stack = document.getElementById('stack');
const scoreEl = document.getElementById('scoreValue');
const comboEl = document.getElementById('comboText');
const historyEl = document.getElementById('history');
const levelEl = document.getElementById('levelValue');
const celebrate = document.getElementById('celebrate');
const ending = document.getElementById('ending');
let level = 1;
const finalLevel = 3;
let history = [];
let score = 0;
let lastCategory = null;
let comboCount = 0;
let comboTimer = null;

function randomPosition(el){
  const bw = board.clientWidth;
  const bh = board.clientHeight;
  const ew = el.offsetWidth;
  const eh = el.offsetHeight;
  el.style.left = Math.random() * Math.max(bw - ew, 0) + 'px';
  el.style.top = Math.random() * Math.max(bh - eh, 0) + 'px';
}

const colors=['#e91e63','#3f51b5','#4caf50','#ff9800','#9c27b0','#009688','#795548'];
const fonts=["'Comic Sans MS',cursive","'Times New Roman',serif","'Arial Black',sans-serif","'Courier New',monospace","'Noto Sans',sans-serif"];

function importanceStyle(importance){
  let size='12px';
  if(importance>=3) size='20px';
  else if(importance==2) size='16px';
  return {size};
}

function showItems(){
  board.innerHTML='';
  const profile = profileSelect.value;
  const items = data[profile];
  const baseCount = Math.floor(Math.random()*6)+5;
  const count = Math.min(items.length, baseCount + level - 1);
  const shuffled = items.slice().sort(()=>Math.random()-0.5).slice(0,count);
  shuffled.forEach(item=>{
    const div = document.createElement('div');
    div.className='item';
    div.textContent=item.text;
    const style = importanceStyle(item.importance);
    const extraColor = colors[Math.floor(Math.random()*colors.length)];
    const font = fonts[Math.floor(Math.random()*fonts.length)];
    div.style.color=extraColor;
    div.style.fontSize=style.size;
    div.style.fontFamily=font;
    div.style.fontStyle=Math.random()<0.5?'italic':'normal';
    div.style.fontWeight=Math.random()<0.5?'bold':'normal';
    board.appendChild(div);
    div.addEventListener('click', ()=>{
      board.removeChild(div);
      const now = new Date();
      history.push({text:item.text,time:now,profile:profile,category:item.category});
      addHistory(item.text, now, profile, item.category);

      // explosion effect
      const boom=document.createElement('span');
      boom.textContent='üí•';
      boom.className='explode';
      boom.style.left=div.style.left;
      boom.style.top=div.style.top;
      board.appendChild(boom);
      setTimeout(()=>board.removeChild(boom),500);

      // scoring
      score += item.importance * 10;
      scoreEl.textContent = score;

      // combo check
      if(lastCategory === item.category){
        comboCount += 1;
      } else {
        comboCount = 1;
        lastCategory = item.category;
      }
      clearTimeout(comboTimer);
      comboEl.textContent = comboCount > 1 ? `COMBO x${comboCount}!` : '';
      comboTimer = setTimeout(()=>{comboEl.textContent=''; comboCount=0; lastCategory=null;},1500);

      // stack block
      const block=document.createElement('div');
      block.className='block';
      block.style.background=extraColor;
      stack.appendChild(block);

      showComment();

      if(board.querySelectorAll('.item').length===0){
        stageClear();
      }
    });
    randomPosition(div);
  });
}

function addHistory(text,time,profile,category){
  const div=document.createElement('div');
  div.className='history-entry';
  div.textContent=`[${time.toLocaleString()}] (${profile}/${category}) ${text}`;
  historyEl.prepend(div);
}

function showComment(){
  const comments=[
    '„Åù„Çå„ÄÅ‰ªä„ÇÑ„ÇãÊÑèÂë≥„ÅÇ„ÇãÔºü',
    '‰∏ñÁïå„ÅØ„Åæ„Å†Âõû„Å£„Å¶„Çã„Çà',
    '„Åæ„ÅÅ„ÄÅ‰ªäÊó•„ÅØ‰ºë„ÇÇ„ÅÜ',
    'Ê∞ó„Å´„Åó„Å™„ÅÑÊ∞ó„Å´„Åó„Å™„ÅÑ',
    '„Åù„Çå„Çà„Çä„ÅäÊòºÂØù„Åó„Çà„ÅÜ'
  ];
  document.getElementById('catText').textContent=
    comments[Math.floor(Math.random()*comments.length)];
}

function stageClear(){
  celebrate.style.display='flex';
  celebrate.textContent=`„Çπ„ÉÜ„Éº„Ç∏${level}„ÇØ„É™„Ç¢ÔºÅ`;
  setTimeout(()=>{
    celebrate.style.display='none';
    level++;
    if(level>finalLevel){
      showEnding();
    }else{
      levelEl.textContent=level;
      showItems();
    }
  },1500);
}

function showEnding(){
  ending.style.display='block';
}

document.getElementById('refresh').addEventListener('click',showItems);
profileSelect.addEventListener('change',showItems);

window.addEventListener('load',showItems);
setInterval(()=>{
  const items = Array.from(document.querySelectorAll('.item'));
  const moveCount = Math.min(items.length, Math.floor(Math.random()*3)+1);
  for(let i=0;i<moveCount;i++){
    const idx = Math.floor(Math.random()*items.length);
    const el = items.splice(idx,1)[0];
    if(el) randomPosition(el);
  }
},3000);
</script>
</body>
</html>
