<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>鋼鉄都市：灰色の記憶たち - Episode 1</title>
<style>
 body { font-family: sans-serif; background:#000; color:#fff; margin:0; padding:0; }
 #startScreen, #nameScreen, #gameScreen { padding:20px; }
 #background, #characterSprite { height:120px; margin-bottom:10px; }
 #textBox { border:1px solid #555; padding:10px; cursor:pointer; min-height:60px; }
 #speaker { font-weight:bold; margin-right:5px; }
 #choices button { margin-right:10px; margin-top:5px; }
</style>
</head>
<body>
<div id="startScreen">
  <h1>鋼鉄都市：灰色の記憶たち</h1>
  <button id="startBtn">スタート</button>
</div>
<div id="nameScreen" style="display:none;">
  <p>名前を入力してください:</p>
  <input id="playerNameInput" type="text" placeholder="名取">
  <button id="nameOkBtn">決定</button>
</div>
<div id="gameScreen" style="display:none;">
  <div id="background">[背景]</div>
  <div id="characterSprite">[立ち絵]</div>
  <div id="textBox">
    <span id="speaker"></span><span id="message"></span>
  </div>
  <div id="choices"></div>
</div>
<script>
let playerName = '名取';
const startBtn = document.getElementById('startBtn');
const nameOkBtn = document.getElementById('nameOkBtn');
const startScreen = document.getElementById('startScreen');
const nameScreen = document.getElementById('nameScreen');
const gameScreen = document.getElementById('gameScreen');
const speakerEl = document.getElementById('speaker');
const messageEl = document.getElementById('message');
const backgroundEl = document.getElementById('background');
const spriteEl = document.getElementById('characterSprite');
const choicesEl = document.getElementById('choices');
const textBox = document.getElementById('textBox');

const scenes = {
  scene1: {
    bg:'office',
    sprite:'',
    lines:[{speaker:'', text:'灰色の雨がアスファルトを濡らす朝—私立探偵・{player}の一日は、猫の鳴き声で始まった。'}],
    choices:[{text:'次へ', next:'scene2'}]
  },
  scene2: {
    bg:'office',
    sprite:'cat',
    lines:[
      {speaker:'猫', text:'ニャア。'},
      {speaker:'{player}', text:'また猫か……どうしてうちに迷い込んでくるんだ。'}
    ],
    choices:[{text:'次へ', next:'scene3'}]
  },
  scene3: {
    bg:'office',
    sprite:'cat',
    lines:[{speaker:'{player}', text:'さて、どうしたものか……'}],
    choices:[
      {text:'仕方ない、拾ってやる', next:'takeCat'},
      {text:'時間がない、後回しだ', next:'ignoreCat'}
    ]
  },
  takeCat: {
    bg:'office',
    sprite:'cat',
    lines:[{speaker:'{player}', text:'よし、ついて来い。'}],
    choices:[{text:'つづく', next:null}]
  },
  ignoreCat: {
    bg:'office',
    sprite:'',
    lines:[{speaker:'{player}', text:'すまない、今日は忙しいんだ。'}],
    choices:[{text:'つづく', next:null}]
  }
};

let currentScene = null;
let lineIndex = 0;

function replaceTags(text){
  return text.replace('{player}', playerName);
}

function startScene(id){
  currentScene = scenes[id];
  lineIndex = 0;
  backgroundEl.textContent = '[' + currentScene.bg + ']';
  spriteEl.textContent = '[' + currentScene.sprite + ']';
  showLine();
}

function showLine(){
  if(lineIndex < currentScene.lines.length){
    const line = currentScene.lines[lineIndex];
    speakerEl.textContent = replaceTags(line.speaker);
    messageEl.textContent = replaceTags(line.text);
    choicesEl.innerHTML = '';
  } else {
    speakerEl.textContent = '';
    messageEl.textContent = '';
    choicesEl.innerHTML = '';
    currentScene.choices.forEach(ch => {
      const btn = document.createElement('button');
      btn.textContent = ch.text;
      btn.onclick = () => {
        if(ch.next){
          startScene(ch.next);
        }else{
          messageEl.textContent = '続きは次回…';
          choicesEl.innerHTML = '';
        }
      };
      choicesEl.appendChild(btn);
    });
  }
}

startBtn.onclick = () => {
  startScreen.style.display='none';
  nameScreen.style.display='block';
};

nameOkBtn.onclick = () => {
  const nameInput = document.getElementById('playerNameInput').value.trim();
  if(nameInput) playerName = nameInput;
  nameScreen.style.display='none';
  gameScreen.style.display='block';
  startScene('scene1');
};

textBox.addEventListener('click', () => {
  if(lineIndex < currentScene.lines.length){
    lineIndex++;
    showLine();
  }
});
</script>
</body>
</html>
